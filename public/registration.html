<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Market - Register</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="registration.css">
</head>
<body>
    <header>
        <div class="site-name"><a href="/home">Dream Market</a></div>
        <div class="search-bar">
            <input type="text" placeholder="Search for products..." id="search">
            <button type="button">Search</button>
        </div>
    </header>
    <nav>
        <ul>
            <li class="navbaroption">
                <div class="dropdown">
                    <a class="dropbtn" href="#">Category 1</a>
                    <div class="dropdown-content">
                        <a href="#">Subcategory 1</a>
                        <a href="#">Subcategory 2</a>
                        <a href="#">Subcategory 3</a>
                    </div>
                </div>
            </li>
            <li class="navbaroption">
                <div class="dropdown">
                    <a class="dropbtn" href="#">Category 2</a>
                    <div class="dropdown-content">
                        <a href="#">Subcategory 1</a>
                        <a href="#">Subcategory 2</a>
                        <a href="#">Subcategory 3</a>
                    </div>
                </div>
            </li>
            <li class="navbaroption">
                <div class="dropdown">
                    <a class="dropbtn" href="#">Category 3</a>
                    <div class="dropdown-content">
                        <a href="#">Subcategory 1</a>
                        <a href="#">Subcategory 2</a>
                        <a href="#">Subcategory 3</a>
                    </div>
                </div>
            </li>
            <li class="navbaroption">
                <div class="dropdown">
                    <a class="dropbtn" href="#">Category 4</a>
                    <div class="dropdown-content">
                        <a href="#">Subcategory 1</a>
                        <a href="#">Subcategory 2</a>
                        <a href="#">Subcategory 3</a>
                    </div>
                </div>
            </li>
            <li class="navbaroption">
                <div class="dropdown">
                    <a class="dropbtn" href="#">Category 5</a>
                    <div class="dropdown-content">
                        <a href="#">Subcategory 1</a>
                        <a href="#">Subcategory 2</a>
                        <a href="#">Subcategory 3</a>
                    </div>
                </div>
            </li>
            <li class="navbaroption" style="float:right"><a href="/settings"><img src="images/settings-2-svgrepo-com.svg"></a></li>
            <li class="navbaroption" style="float:right"><a href="#"><img src="images/shopping-cart-svgrepo-com.svg"></a></li>
            <li class="navbaroption" style="float:right"><a href="#"><img src="images/person-svgrepo-com.svg"></a></li>
        </ul>
    </nav>
    <div class="container">
        <h1>Create an account</h1>
        <form action="/register" method="POST">
            <input type="text" placeholder="First name" id="firstName" required>
            <input type="text" placeholder="Last name" id="lastName" required>
            <input type="email" placeholder="Email" id="email" required>
            <input type="password" placeholder="Password" id="password" required>
            <input type="password" placeholder="Re-Enter Password" id="confirmPassword" required>

            <p>By selecting <b>Create personal account</b>, you agree to our <a href="#">User Agreement</a> and acknowledge reading our <a href="#">User Privacy Notice</a>.</p>

            <button type="submit">Create personal account</button>
        </form>

        <p>Already have an account? <a href="/login">Sign in</a></p>
    </div>

    <footer>
        &copy; 2024 Dream Market Inc.
    </footer>
    <script>
    document.querySelector("form").addEventListener("submit", async (e) => {
        e.preventDefault(); // Prevent default form submission

        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        console.log({ first_name: firstName, last_name: lastName, email, password }); // Debugging output

        try {
            const response = await fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    password: password
                })
            });

            const data = await response.json();

            if (response.ok) {
                alert("Registration successful!");
                window.location.href = '/login'; // Redirect to login page
            } else {
                alert(data.error || "Registration failed. Please try again.");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("An error occurred. Please try again later.");
        }
    });  
    </script>
</body>
</html>